<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/layout.html}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğ“¦ğ“¸ğ“¸ğ“»ğ“²</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div layout:fragment="content">
    
    <link rel="stylesheet" th:href="@{'/style/skin/default/common/board/detail.css'}">
    
    <div class="detail-container">
        <!-- ê²Œì‹œê¸€ í—¤ë” -->
        <div class="detail-header">
            <h1 class="detail-title" th:text="${board.boardTitle}">ê²Œì‹œê¸€ ì œëª©</h1>
            <div class="detail-meta">
                <div class="detail-meta-item">
                    <i class="fas fa-user"></i>
                    <span th:text="${board.member.memberName}">ì‘ì„±ì</span>
                </div>
                <div class="detail-meta-item">
                    <i class="fas fa-calendar"></i>
                    <span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}">ì‘ì„±ì¼</span>
                </div>
                <div class="detail-meta-item" th:if="${board.isNotice}">
                    <i class="fas fa-bullhorn"></i>
                    <span>ê³µì§€ì‚¬í•­</span>
                </div>
            </div>
        </div>
        
        <!-- ê²Œì‹œê¸€ ë‚´ìš© -->
        <div class="detail-content" th:utext="${board.boardContent}">
            ê²Œì‹œê¸€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>
        
        <!-- ì²¨ë¶€íŒŒì¼ -->
        <div class="detail-attachments" th:if="${board.filesMeta != null and !board.filesMeta.isEmpty()}">
            <div class="attachments-title">
                <i class="fas fa-paperclip"></i>
                <span>ì²¨ë¶€íŒŒì¼</span>
            </div>
            <ul class="attachment-list">
                <li class="attachment-item" th:each="file : ${board.filesMeta}">
                    <div class="attachment-info">
                        <div class="attachment-icon">
                            <i class="fas fa-file"></i>
                        </div>
                        <div>
                            <div class="attachment-name"> <a th:href="${file.filePath}" th:text="${file.fileName}"></a></div>
                            <span class="attachment-size"><span th:text="${#numbers.formatDecimal(file.fileSize / 1048576.0, 1, 2)}"></span> MB</span>
                        </div>
                    </div>
                    <a th:href="${file.filePath}" class="attachment-download" download>
                    <i class="fas fa-download"></i>
                        ë‹¤ìš´ë¡œë“œ
                    </a>
                </li>
            </ul>
        </div>


        <div class="detail-actions">
           <div class="detail-actions-left">
                <a th:href="@{'/' + ${group} + '/' + ${category} + '/list'}" class="btn btn-secondary">
                    <i class="fas fa-list"></i>
                    ëª©ë¡
                </a>
            </div>
            <div th:if="${board.isWriter}" class="detail-actions-right">
                <a th:href="@{'/' + ${group} + '/' + ${category} + '/modify/' + ${board.BoardNum}}" class="btn btn-primary">
                    <i class="fas fa-edit"></i>
                    ìˆ˜ì •
                </a>

                <form th:if="${board.isWriter}" th:action="@{'/' + ${group} + '/' + ${category} + '/delete/' + ${num}}" method="post">
                    <input hidden th:value="${board.Member.MemberNum}" name="writerNum">
                <button type="submit" class="btn btn-danger" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
                    <i class="fas fa-trash"></i>
                    ì‚­ì œ
                </button>
                </form>
            </div>
        </div>
    </div>
    
</div>

<div layout:fragment="script">



    <script th:inline="javascript">
        const group = /*[[${group}]]*/ '';
        const category = /*[[${category}]]*/ '';
        const boardNum = /*[[${board.BoardNum}]]*/ '';

        document.addEventListener('DOMContentLoaded', () => {
            const screenMaxWidth = window.innerWidth * 0.9;
            const screenMaxHeight = window.innerHeight * 0.9;

            document.querySelectorAll('.detail-content img').forEach(img => {
                img.addEventListener('click', () => {
                    const src = img.dataset.full || img.src;

                    const tempImg = new Image();
                    tempImg.src = src;
                    tempImg.onload = () => {
                        let w = tempImg.width;
                        let h = tempImg.height;

                        if (w > screenMaxWidth) {
                            h = h * (screenMaxWidth / w);
                            w = screenMaxWidth;
                        }
                        if (h > screenMaxHeight) {
                            w = w * (screenMaxHeight / h);
                            h = screenMaxHeight;
                        }

                        const left = (window.innerWidth - w) / 2 + window.screenX;
                        const top = (window.innerHeight - h) / 2 + window.screenY;

                        window.open(
                            src,
                            '_blank',
                            `width=${Math.round(w)},height=${Math.round(h)},left=${Math.round(left)},top=${Math.round(top)},resizable=yes,scrollbars=yes`
                        );
                    };
                });
            });
        });
    </script>
</div>

</body>
</html>
